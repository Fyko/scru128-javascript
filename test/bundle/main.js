(()=>{"use strict";var t={941:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.randomFillSync=void 0,e.randomFillSync=void 0},590:(t,e,n)=>{e.L9=e.rI=void 0;const r=n(941),s=268435455,i=()=>"undefined"!=typeof window&&window.crypto?t=>window.crypto.getRandomValues(new Uint16Array(Math.ceil(t/16))).reduce(((t,e)=>65536*t+e))%Math.pow(2,t):r.randomFillSync?t=>(0,r.randomFillSync)(new Uint16Array(Math.ceil(t/16))).reduce(((t,e)=>65536*t+e))%Math.pow(2,t):(console.warn("scru128: fell back on Math.random() as no cryptographic RNG was detected"),t=>t>30?1073741824*Math.trunc(Math.random()*Math.pow(2,t-30))+Math.trunc(1073741824*Math.random()):Math.trunc(Math.random()*Math.pow(2,t)));class o{constructor(t,e,n,r){if(this.timestamp=t,this.counter=e,this.perSecRandom=n,this.perGenRandom=r,!Number.isInteger(this.timestamp)||!Number.isInteger(this.counter)||!Number.isInteger(this.perSecRandom)||!Number.isInteger(this.perGenRandom)||this.timestamp<0||this.counter<0||this.perSecRandom<0||this.perGenRandom<0||this.timestamp>0xfffffffffff||this.counter>s||this.perSecRandom>16777215||this.perGenRandom>4294967295)throw new RangeError("invalid field value")}static fromFields(t,e,n,r){return new o(t,e,n,r)}toString(){const t=16*this.timestamp+(this.counter>>24),e=65536*(16777215&this.counter)+(this.perSecRandom>>8),n=4294967296*(255&this.perSecRandom)+this.perGenRandom;return(("000000000"+t.toString(32)).slice(-10)+("0000000"+e.toString(32)).slice(-8)+("0000000"+n.toString(32)).slice(-8)).toUpperCase()}static fromString(t){const e=t.match(/^([0-7][0-9A-V]{9})([0-9A-V]{8})([0-9A-V]{8})$/i);if(null===e)throw new SyntaxError("invalid string representation: "+t);const n=parseInt(e[1],32),r=parseInt(e[2],32),s=parseInt(e[3],32);return new o(Math.trunc(n/16),n%16<<24|Math.trunc(r/65536),r%65536<<8|Math.trunc(s/4294967296),s%4294967296)}}const a=new class{constructor(){this.tsLastGen=0,this.counter=0,this.tsLastSec=0,this.perSecRandom=0,this.getRandomBits=i()}generate(){let t=Date.now();if(t>this.tsLastGen)this.tsLastGen=t,this.counter=this.getRandomBits(28);else if(++this.counter>s){let e=0;for(;t<=this.tsLastGen;)if(t=Date.now(),++e>1e6){console.warn("scru128: reset state as clock did not go forward"),this.tsLastSec=0;break}this.tsLastGen=t,this.counter=this.getRandomBits(28)}return this.tsLastGen-this.tsLastSec>1e3&&(this.tsLastSec=this.tsLastGen,this.perSecRandom=this.getRandomBits(24)),o.fromFields(this.tsLastGen-15778368e5,this.counter,this.perSecRandom,this.getRandomBits(32))}};e.rI=()=>a.generate().toString(),e.L9={Scru128Id:o,detectRng:i}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}(()=>{var t=n(590);const e=(t,e="")=>{if(!t)throw new Error("Assertion failed"+(e?": "+e:""))};describe("scru128()",(function(){const n=[];for(let e=0;e<1e5;e++)n[e]=(0,t.rI)();it("generates 26-digit canonical string",(function(){const t=/^[0-7][0-9A-V]{25}$/;e(n.every((e=>"string"==typeof e&&t.test(e))))})),it("generates 100k identifiers without collision",(function(){e(new Set(n).size===n.length)})),it("generates sortable string representation by creation time",(function(){const t=n.slice().sort();for(let r=0;r<n.length;r++)e(n[r]===t[r])})),it("encodes up-to-date timestamp",(function(){const n=Date.UTC(2020,0);for(let r=0;r<1e4;r++){const r=Date.now()-n,s=t.L9.Scru128Id.fromString((0,t.rI)()).timestamp;e(Math.abs(r-s)<16)}})),it("encodes unique sortable pair of timestamp and counter",(function(){let r=t.L9.Scru128Id.fromString(n[0]);for(let s=1;s<n.length;s++){const i=t.L9.Scru128Id.fromString(n[s]);e(r.timestamp<i.timestamp||r.timestamp===i.timestamp&&r.counter<i.counter),r=i}}))}))})(),(()=>{var t=n(590);const e=(t,e="")=>{if(!t)throw new Error("Assertion failed"+(e?": "+e:""))};describe("Internal",(function(){describe("Scru128Id",(function(){it("encodes and decodes prepared cases correctly",(function(){const n=[[[0,0,0,0],"00000000000000000000000000"],[[2**44-1,0,0,0],"7VVVVVVVVG0000000000000000"],[[0,2**28-1,0,0],"000000000FVVVVU00000000000"],[[0,0,2**24-1,0],"000000000000001VVVVS000000"],[[0,0,0,2**32-1],"00000000000000000003VVVVVV"],[[2**44-1,2**28-1,2**24-1,2**32-1],"7VVVVVVVVVVVVVVVVVVVVVVVVV"]],r=["timestamp","counter","perSecRandom","perGenRandom"];for(const s of n){const n=t.L9.Scru128Id.fromFields(...s[0]),i=t.L9.Scru128Id.fromString(s[1]);e(n.toString()===s[1]&&i.toString()===s[1]);for(let t=0;t<r.length;t++)e(n[r[t]]===s[0][t]&&i[r[t]]===s[0][t])}})),it("has symmetric fromString() and toString()",(function(){for(let n=0;n<1e3;n++){const n=(0,t.rI)();e(t.L9.Scru128Id.fromString(n).toString()===n)}}))})),describe("getRandomBits()",(function(){const n=t.L9.detectRng();it("generates uniformly distributed random bits",(function(){const t=4.417173*Math.sqrt(125e-6);for(let r=4;r<=48;r+=4){const s=2**r,i=new Array(r).fill(0);for(let t=0;t<2e3;t++){let t=n(r);e(0<=t&&t<s);for(let e=0;e<r;e++)i[r-e-1]+=t%2,t=Math.trunc(t/2);e(0===t)}for(let n=0;n<r;n++){const r=i[n]/2e3;e(Math.abs(r-.5)<t,`Msb ${n}: ${r}`)}}}))}))}))})()})();